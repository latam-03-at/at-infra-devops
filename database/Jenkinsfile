pipeline {
    agent { label 'linux-agent' }
    parameters {
        choice(name: 'Environment', choices: ['Development', 'Production'], description: 'Choose an environment where deploy the Database')
    }
    environment {
        DEPLOY_TO = "${params.Environment}"
    }
    stages {
        stage ('Deploy to Development') {
            when {
                environment name: 'DEPLOY_TO', value: 'Development'
            }
            environment {
                FOLDER_NAME = "mongodbdev"
            }
            steps {
                echo "Environment: ${DEPLOY_TO}"
                sshagent(['az-ubuntu-dev-vm']) {
                    sh "ssh -o 'StrictHostKeyChecking no' 20.228.132.238 mkdir -p /home/calebespinoza/$FOLDER_NAME"
                    sh "scp database/docker-compose.yml 20.228.132.238:~/$FOLDER_NAME"
                    sh "ssh -o 'StrictHostKeyChecking no' 20.228.132.238 ls -a /home/calebespinoza/$FOLDER_NAME"
                }
            }
        }

        stage ('Deploy to Production') {
            when {
                environment name: 'DEPLOY_TO', value: 'Production'
            }
            steps {
                echo "Environment: ${DEPLOY_TO}"
            }
        }
    }
}